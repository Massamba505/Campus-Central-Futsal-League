<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Off-brand supersport</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="fonts/icomoon/style.css" />

    <link rel="stylesheet" href="css/bootstrap/bootstrap.css" />
    <link rel="stylesheet" href="css/jquery-ui.css" />
    <link rel="stylesheet" href="css/owl.carousel.min.css" />
    <link rel="stylesheet" href="css/owl.theme.default.min.css" />
    <link rel="stylesheet" href="css/owl.theme.default.min.css" />

    <link rel="stylesheet" href="css/jquery.fancybox.min.css" />

    <link rel="stylesheet" href="css/bootstrap-datepicker.css" />

    <link rel="stylesheet" href="fonts/flaticon/font/flaticon.css" />

    <link rel="stylesheet" href="css/aos.css" />

    <link rel="stylesheet" href="css/style.css" />

    <style>
      option, #match-id {
          background-color: #222831; 
          color: #fff;
      }
    </style>

  </head>

  <body>
    <div class="site-wrap">
      
    <div class="site-mobile-menu site-navbar-target">
        <div class="site-mobile-menu-header">
        <div class="site-mobile-menu-close">
            <span class="icon-close2 js-menu-toggle"></span>
        </div>
        </div>
        <div class="site-mobile-menu-body"></div>
    </div>

      <header class="site-navbar py-4" role="banner">
          <div class="container">
              <div class="d-flex align-items-center">
                  <div class="ml-auto">
                      <nav class="site-navigation position-relative text-right" role="navigation">
                        <ul class="site-menu main-menu js-clone-nav mr-auto d-none d-lg-block">
                          <li><a href="index.html" class="nav-link">Home</a></li>
                          <!-- <li><a href="editStandings.html" class="nav-link">Edit Standings</a></li> -->
                          <li><a href="signup.html" class="nav-link">Create User</a></li>
                          <li class="active"><a href="admin.html" class="nav-link">Admin</a></li>
                          <li><a id="logout" href="/auth/logout" class="nav-link">logout</a></li>
                        </ul>
                      </nav>
                      <a href="#" class="d-inline-block d-lg-none site-menu-toggle js-menu-toggle text-black float-right text-white"><span class="icon-menu h3 text-white"></span></a>
                  </div>
              </div>
          </div>
      </header>

      <div class="hero overlay py-4" style="background-image: url('images/bg_3.jpg')">
        <div class="container">
          <div class="row align-items-center">
            <div class="col-lg-5 mx-auto text-center">
              <h1 class="text-white">Administration</h1>
              <p>Manage teams and players efficiently.</p>
            </div>
          </div>
        </div>
      </div>
      
      <div class="container"></div>
      <br><br><br>

      <div class="container">
        <div class="row">
          <div class="col-lg-6 mb-4">
            <h2>Register New Player</h2>
            <form id="player-form" enctype="multipart/form-data">
              <div class="form-group">
                <label for="player-name">Name</label>
                <input type="text" id="player-name" class="form-control" required />
              </div>
              <div class="form-group">
                <label for="player-surname">Surname</label>
                <input type="text" id="player-surname" class="form-control" required />
              </div>
              <div class="form-group">
                <label for="team-id">Team</label>
                <select id="team-id" class="form-control" required></select>
              </div>
              <div class="form-group">
                <label for="player-photo">Photo</label>
                <input type="file" id="player-photo" class="form-control" accept="image/*" />
              </div>
              <button type="submit" class="btn btn-primary">Register Player</button>
            </form>
          </div>

          <div class="col-lg-6 mb-4">
            <h2>Register New Team</h2>
            <form id="team-form" enctype="multipart/form-data">
              <div class="form-group">
                <label for="team-name">Team Name</label>
                <input type="text" id="team-name" class="form-control" required />
              </div>
              <div class="form-group">
                <label for="team-logo">Team Logo</label>
                <input type="file" id="team-logo" class="form-control" accept="image/*" required />
              </div>
              <button type="submit" class="btn btn-primary">Register Team</button>
            </form>
          </div>
        </div>
        
        <!-- Section to Update Player Goals and Assists -->
        <div class="row">
          <!-- <div class="col-lg-6 mb-4">
          <h1>Add New Match</h1>
          <form id="add-match-form">
              <div class="form-group">
                  <label for="home">Team 1</label>
                  <select id="home" class="form-control" required></select>
              </div>
              <div class="form-group">
                  <label for="away">Team 2</label>
                  <select id="away" class="form-control" required></select>
              </div>
              <div class="form-group">
                  <label for="datetime">Date and Time</label>
                  <input type="datetime-local" class="form-control" id="datetime" required />
              </div>
              <div class="form-group">
                  <label for="location">Location</label>
                  <input type="text" class="form-control" id="location" value="CC #1" required />
              </div>
              <button type="submit" class="btn btn-primary">Add Match</button>
          </form>
          </div> -->
      
          <div class="col-lg-6 mb-4">
            <h2>Update Player Stats</h2>
            <form id="update-player-form">
              <div class="form-group">
                <label for="select-player">Select Player</label>
                <select id="select-player" class="form-control" required></select>
              </div>
              <div class="form-group">
                <label for="player-goals">Goals</label>
                <input type="number" value="0" id="player-goals" class="form-control" min="0" required />
              </div>
              <!-- <div class="form-group">
                <label for="player-assists">Assists</label>
                <input type="number" value="0" id="player-assists" class="form-control" min="0" required />
              </div> -->
              <button type="submit" class="btn btn-primary">Update Stats</button>
            </form>
          </div>
        </div>

        <!-- <div class="row">
          <div class="col-lg-6 mb-4">
            <h1>Edit Match Score</h1>
            <form id="edit-score-form">
              <div class="form-group">
                <label for="match-id">Select Match</label>
                <select id="match-id" class="form-control" required></select>
              </div>
              <div class="form-group">
                <label for="home-goals">Home Team Goals</label>
                <input value="0" type="number" id="home-goals" class="form-control" min="0" required />
              </div>
              <div class="form-group">
                <label for="away-goals">Away Team Goals</label>
                <input value="0" type="number" id="away-goals" class="form-control" min="0" required />
              </div>
              <button type="submit" class="btn btn-primary">Update Score</button>
            </form>
          </div>
        </div> -->
        
      </div>
      <br><br><br>

      <footer class="footer-section">
        <div class="container">
          <div class="row d-flex justify-content-center">
            <div class="col-lg-3">
              <div class="widget mb-3">
                <h3>Matches</h3>
                <ul class="list-unstyled links">
                  <li><a href="index.html">Home</a></li>
                  <!-- <li><a href="matches.html">Matches</a></li>
                  <li><a href="standing.html">Standings</a></li> -->
                  <li><a href="stats.html">Stats</a></li>
                  <li><a href="admin.html">admin</a></li>
                </ul>
              </div>
            </div>

            <div class="col-lg-3">
              <div class="widget mb-3">
                <h3>Social</h3>
                <ul class="list-unstyled links">
                  <li><a href="#">Twitter</a></li>
                  <li><a href="#">Facebook</a></li>
                  <li><a href="#">Instagram</a></li>
                  <li><a href="#">Youtube</a></li>
                </ul>
              </div>
            </div>
          </div>

          <div class="row text-center">
            <div class="col-md-12">
              <div class="pt-5">
                <p>
                  <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                  Copyright &copy;
                  <script>
                    document.write(new Date().getFullYear());
                  </script>
                  All rights reserved
                  <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                </p>
              </div>
            </div>
          </div>
        </div>
      </footer>

    </div>

    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/jquery-migrate-3.0.1.min.js"></script>
    <script src="js/jquery-ui.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/jquery.stellar.min.js"></script>
    <script src="js/jquery.countdown.min.js"></script>
    <script src="js/bootstrap-datepicker.min.js"></script>
    <script src="js/jquery.easing.1.3.js"></script>
    <script src="js/aos.js"></script>
    <script src="js/jquery.fancybox.min.js"></script>
    <script src="js/jquery.sticky.js"></script>
    <script src="js/jquery.mb.YTPlayer.min.js"></script>
    <script src="js/main.js"></script>

    <script>
      async function fetchTeams() {
        const response = await fetch('/allTeams');
        const teams = await response.json();
        const teamSelect = document.getElementById('team-id');
        teamSelect.innerHTML = "";

        teams.forEach(team => {
          const option = document.createElement('option');
          option.value = team.name;
          option.textContent = team.name;
          teamSelect.appendChild(option);
        });

        // const teamSelectHome = document.getElementById('home');
        // teamSelectHome.innerHTML = "";

        // teams.forEach(team => {
        // const option = document.createElement('option');
        // option.value = team.name;
        // option.textContent = team.name;
        // teamSelectHome.appendChild(option);
        // });

        // const teamSelectAway = document.getElementById('away');
        // teamSelectAway.innerHTML = "";

        // teams.forEach(team => {
        // const option = document.createElement('option');
        // option.value = team.name;
        // option.textContent = team.name;
        // teamSelectAway.appendChild(option);
        // });
      }

      
      async function fetchPlayers() {
        const response = await fetch('/allPlayers');
        const players = await response.json();
        const playerSelect = document.getElementById('select-player');
        playerSelect.innerHTML = "";

        players.forEach((player,i) => {
          if(i == 0){
            document.getElementById("player-goals").value = Number(player.goals);
          }
          const option = document.createElement('option');
          option.value = player.fullname; // Assuming players have unique IDs
          option.textContent = `${player.fullname}`;
          playerSelect.appendChild(option);
        });
      }

      // async function fetchMatches() {
      //   const response = await fetch('/current-match');
      //   const matches = await response.json();
      //   const matchSelect = document.getElementById('match-id');
      //   matchSelect.innerHTML = "";
      //   console.log(matches);

      //   matches.forEach(match => {
      //     const option = document.createElement('option');
      //     option.value = match._id; 
      //     option.textContent = `${match.fixture.home.name} vs ${match.fixture.away.name}`;
      //     matchSelect.appendChild(option);
      //   });
      // }


      document.addEventListener('DOMContentLoaded', () => {
        fetchTeams();
        fetchPlayers();
        // fetchMatches();
      });

      document.getElementById('player-form').addEventListener('submit', async function(e) {
        e.preventDefault();

        const formData = new FormData();
        formData.append('name', document.getElementById('player-name').value);
        formData.append('surname', document.getElementById('player-surname').value);
        const teamId = document.getElementById('team-id').value;
        if (!teamId) {
          alert('Please select a team.');
          return;
        }
        formData.append('teamId', teamId);
        formData.append('photo', document.getElementById('player-photo').files[0]);

        try {
          const response = await fetch('/register/player', {
            method: 'POST',
            body: formData
          });

          if (response.ok) {
            alert('Player registered successfully!');
            document.getElementById('player-form').reset();
            fetchPlayers();
          } else {
            const errorData = await response.json();
            alert(`Failed to register player: ${errorData.error || 'Unknown error'}`);
          }
        } catch (error) {
          console.error('Error:', error);
          alert('An error occurred while registering the player.');
        }
      });

      document.getElementById('team-form').addEventListener('submit', async function(e) {
        e.preventDefault();

        const formData = new FormData();
        formData.append('name', document.getElementById('team-name').value);
        formData.append('logo', document.getElementById('team-logo').files[0]);

        try {
          const response = await fetch('/register/team', {
            method: 'POST',
            body: formData
          });

          if (response.ok) {
            alert('Team registered successfully!');
            document.getElementById('team-form').reset();
            fetchTeams();
          } else {
            alert('Failed to register team.');
          }
        } catch (error) {
          console.error('Error:', error);
        }
      });

      document.getElementById('update-player-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        const fullname = document.getElementById('select-player').value.trim();
        const goals = document.getElementById('player-goals').value.trim();
        // const assists = document.getElementById('player-assists').value.trim();
        
        if (!fullname || !goals) {
            alert('All fields are required.');
            return;
        }

        const data = {
            fullname,
            goals
        };

        try {
            const response = await fetch('/editplayer', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            });

            if (response.ok) {
                alert('Player stats updated successfully!');
                document.getElementById('update-player-form').reset();
            } else {
                const errorData = await response.json();
                alert(`Failed to update player stats: ${errorData.error || 'Unknown error'}`);
            }
        } catch (error) {
            console.error('Error:', error);
            alert('An error occurred while updating player stats.');
        }
      });
      
    //   document.getElementById('add-match-form').addEventListener('submit', async function(e) {
    //     e.preventDefault();
        
    //     const data = {
    //         home: document.getElementById('home').value,
    //         away: document.getElementById('away').value,
    //         datetime: document.getElementById('datetime').value,
    //         location: document.getElementById('location').value
    //     };

    //     try {
    //         const response = await fetch('/addMatches', {
    //             method: 'POST',
    //             headers: {
    //                 'Content-Type': 'application/json'
    //             },
    //             body: JSON.stringify(data)
    //         });

    //         if (response.ok) {
    //             alert('Match added successfully!');
    //             document.getElementById('add-match-form').reset();
    //         } else {
    //             const errorData = await response.json();
    //             alert(`Failed to add a match: ${errorData.error || 'Unknown error'}`);
    //         }
    //     } catch (error) {
    //         console.error('Error:', error);
    //         alert('An error occurred while adding a match.');
    //     }
    // });
      
      document.getElementById('logout').addEventListener('click',()=>{
        fetch("/auth/logout")
        .then((res)=>{
          window.location.href = "index.html";
        })
        .catch((error)=>{
          console.log(error);
        })
      });

      // document.getElementById('edit-score-form').addEventListener('submit', async function(e) {
      //   e.preventDefault();
        
      //   const matchId = document.getElementById('match-id').value.trim();
      //   const homeGoals = document.getElementById('home-goals').value.trim();
      //   const awayGoals = document.getElementById('away-goals').value.trim();

      //   if (!matchId || homeGoals === '' || awayGoals === '') {
      //     alert('All fields are required.');
      //     return;
      //   }

      //   const data = {
      //     homeGoals,
      //     awayGoals
      //   };

      //   try {
      //     const response = await fetch(`/editMatchScore/${matchId}`, {
      //       method: 'POST',
      //       headers: {
      //         'Content-Type': 'application/json'
      //       },
      //       body: JSON.stringify(data)
      //     });

      //     if (response.ok) {
      //       alert('Match score updated successfully!');
      //       document.getElementById('edit-score-form').reset();
      //     } else {
      //       const errorData = await response.json();
      //       alert(`Failed to update score: ${errorData.error || 'Unknown error'}`);
      //     }
      //   } catch (error) {
      //     console.error('Error:', error);
      //     alert('An error occurred while updating the score.');
      //   }
      // });
    
      document.getElementById('select-player').addEventListener('change', function() {
        const fullname = document.getElementById('select-player').value.trim();
        // const goals = document.getElementById('player-goals').value.trim();

          fetch("/allPlayers")
              .then(response => response.json())
              .then(players => {
                players.forEach((player,i) => {
                  if(player.fullname === fullname){
                    document.getElementById("player-goals").value = Number(player.goals);
                  }
                });
              })
              .catch(error => console.error('Error fetching player details:', error));
      });



    </script>
  </body>
</html>
