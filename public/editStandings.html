<!DOCTYPE html>
<html lang="en">
<head>
    <title>Admin - Off-brand supersport</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="fonts/icomoon/style.css" />
    <link rel="stylesheet" href="css/bootstrap/bootstrap.css" />
    <link rel="stylesheet" href="css/jquery-ui.css" />
    <link rel="stylesheet" href="css/owl.carousel.min.css" />
    <link rel="stylesheet" href="css/owl.theme.default.min.css" />
    <link rel="stylesheet" href="css/jquery.fancybox.min.css" />
    <link rel="stylesheet" href="css/bootstrap-datepicker.css" />
    <link rel="stylesheet" href="fonts/flaticon/font/flaticon.css" />
    <link rel="stylesheet" href="css/aos.css" />
    <link rel="stylesheet" href="css/style.css" />
    <style>
      option {
          background-color: #222831; 
          color: #fff;
      }
    </style>

</head>

<body>
    <div class="site-wrap">
        <header class="site-navbar py-4" role="banner">
            <div class="container">
                <div class="d-flex align-items-center">
                    <div class="ml-auto">
                        <nav class="site-navigation position-relative text-right" role="navigation">
                            <ul class="site-menu main-menu js-clone-nav mr-auto d-none d-lg-block">
                                <li><a href="index.html" class="nav-link">Home</a></li>
                                <li class="active"><a href="editStandings.html" class="nav-link">Edit Standings</a></li>
                                <li><a href="signup.html" class="nav-link">Create User</a></li>
                                <li><a href="admin.html" class="nav-link">Admin</a></li>
                                <li><a id="logout" href="/auth/logout" class="nav-link">Logout</a></li>
                            </ul>
                        </nav>
                        <a href="#" class="d-inline-block d-lg-none site-menu-toggle js-menu-toggle text-black float-right text-white"><span class="icon-menu h3 text-white"></span></a>
                    </div>
                </div>
            </div>
        </header>
        <div class="hero overlay py-4" style="background-image: url('images/bg_3.jpg')">
          <div class="container">
            <div class="row align-items-center">
              <div class="col-lg-6 mx-auto text-center">
                <h1 class="text-white">Edit Standings</h1>
                <p>Manage Futsal League Standings</p>
              </div>
            </div>
          </div>
        </div>

        <div class="container"><hr></div>

        <div class="site-section bg-dark">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="widget-next-match">
                            <div class="widget-title">
                                <h3>Edit Team Standings</h3>
                            </div>
                            <div class="widget-body mb-3">
                                <form id="edit-standings-form">
                                    <div class="form-group">
                                        <label for="team-selector">Select Team</label>
                                        <select class="form-control" id="team-selector">
                                            <!-- Options will be populated here -->
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="wins">Wins</label>
                                        <input min="0" value="0" type="number" class="form-control" id="wins">
                                    </div>
                                    <div class="form-group">
                                        <label for="draws">Draws</label>
                                        <input min="0" value="0" type="number" class="form-control" id="draws">
                                    </div>
                                    <div class="form-group">
                                        <label for="losses">Losses</label>
                                        <input min="0" value="0" type="number" class="form-control" id="losses">
                                    </div>
                                    <div class="form-group">
                                        <label for="goals-for">Goals For</label>
                                        <input value="0" type="number" class="form-control" id="goals-for">
                                    </div>
                                    <div class="form-group">
                                        <label for="goals-against">Goals Against</label>
                                        <input value="0" type="number" class="form-control" id="goals-against">
                                    </div>
                                    <button type="submit" class="btn btn-primary">Update Standings</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="footer-section">
            <div class="container">
              <div class="row d-flex justify-content-center">
                <div class="col-lg-3">
                  <div class="widget mb-3">
                    <h3>Matches</h3>
                    <ul class="list-unstyled links">
                      <li><a href="index.html">Home</a></li>
                      <li><a href="matches.html">Matches</a></li>
                      <li><a href="standing.html">Standings</a></li>
                      <li><a href="stats.html">Stats</a></li>
                    </ul>
                  </div>
                </div>
    
                <div class="col-lg-3">
                  <div class="widget mb-3">
                    <h3>Social</h3>
                    <ul class="list-unstyled links">
                      <li><a href="#">Twitter</a></li>
                      <li><a href="#">Facebook</a></li>
                      <li><a href="#">Instagram</a></li>
                      <li><a href="#">Youtube</a></li>
                    </ul>
                  </div>
                </div>
              </div>
    
              <div class="row text-center">
                <div class="col-md-12">
                  <div class="pt-5">
                    <p>
                      <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                      Copyright &copy;
                      <script>
                        document.write(new Date().getFullYear());
                      </script>
                      All rights reserved
                      <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </footer>
    
    </div>

    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/jquery-migrate-3.0.1.min.js"></script>
    <script src="js/jquery-ui.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/jquery.stellar.min.js"></script>
    <script src="js/jquery.countdown.min.js"></script>
    <script src="js/bootstrap-datepicker.min.js"></script>
    <script src="js/jquery.easing.1.3.js"></script>
    <script src="js/aos.js"></script>
    <script src="js/jquery.fancybox.min.js"></script>
    <script src="js/jquery.sticky.js"></script>
    <script src="js/jquery.mb.YTPlayer.min.js"></script>
    <script src="js/main.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Fetch teams for the dropdown
            fetch('/standings')
                .then(response => response.json())
                .then(teams => {
                    const teamSelector = document.getElementById('team-selector');
                    teams.forEach((team,i) => {
                        if(i == 0){
                            fetch(`/details?name=${encodeURIComponent(team.name)}`)
                                .then(response => response.json())
                                .then(data => {
                                    if (data) {
                                        document.getElementById('wins').value = data.wins || 0;
                                        document.getElementById('draws').value = data.draws || 0;
                                        document.getElementById('losses').value = data.losses || 0;
                                        document.getElementById('goals-for').value = data.goalsFor || 0;
                                        document.getElementById('goals-against').value = data.goalsAgainst || 0;
                                    }
                                })
                                .catch(error => console.error('Error fetching team details:', error));
                        }
                        const option = document.createElement('option');
                        option.value = team.name;
                        option.textContent = team.name;
                        teamSelector.appendChild(option);
                    });
                })
                .catch(error => console.error('Error fetching teams:', error));

            document.getElementById('team-selector').addEventListener('change', function() {
                const selectedTeam = this.value;

                fetch(`/details?name=${encodeURIComponent(selectedTeam)}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data) {
                            document.getElementById('wins').value = data.wins || 0;
                            document.getElementById('draws').value = data.draws || 0;
                            document.getElementById('losses').value = data.losses || 0;
                            document.getElementById('goals-for').value = data.goalsFor || 0;
                            document.getElementById('goals-against').value = data.goalsAgainst || 0;
                        }
                    })
                    .catch(error => console.error('Error fetching team details:', error));
            });

            // Handle form submission
            document.getElementById('edit-standings-form').addEventListener('submit', function(e) {
                e.preventDefault();

                const name = document.getElementById('team-selector').value;
                const wins = document.getElementById('wins').value;
                const draws = document.getElementById('draws').value;
                const losses = document.getElementById('losses').value;
                const goalsFor = document.getElementById('goals-for').value;
                const goalsAgainst = document.getElementById('goals-against').value;

                fetch(`/changinstandings`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name,
                        wins,
                        draws,
                        losses,
                        goalsFor,
                        goalsAgainst
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Team standings updated successfully');
                    } else {
                        alert('Error updating team standings');
                    }
                })
                .catch(error => console.error('Error updating standings:', error));
            });

            // Handle logout
            document.getElementById('logout').addEventListener('click', (e) => {
                e.preventDefault(); // Prevent default anchor behavior

                fetch("/auth/logout")
                    .then((res) => {
                        if (res.ok) {
                            window.location.href = "index.html";
                        } else {
                            alert('Error logging out');
                        }
                    })
                    .catch((error) => {
                        console.log(error);
                    });
            });
        });
    </script>
</body>
</html>
